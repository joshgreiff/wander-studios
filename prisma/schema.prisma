generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Class {
  id              Int              @id @default(autoincrement())
  date            DateTime
  time            String
  description     String
  capacity        Int
  createdAt       DateTime         @default(now())
  address         String?
  archived        Boolean          @default(false)
  bookings        Booking[]
  packageBookings PackageBooking[]
}

model Booking {
  id           Int      @id @default(autoincrement())
  classId      Int
  name         String
  email        String
  phone        String?
  waiverName   String
  waiverAgreed Boolean
  paid         Boolean  @default(false)
  createdAt    DateTime @default(now())
  waiverId     Int?
  class        Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  waiver       Waiver?  @relation(fields: [waiverId], references: [id])
}

model ClassPackage {
  id              Int              @id @default(autoincrement())
  name            String
  description     String
  classCount      Int
  price           Float
  discount        Float?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  packageBookings PackageBooking[]
}

model PackageBooking {
  id            Int          @id @default(autoincrement())
  packageId     Int
  classId       Int
  customerName  String
  customerEmail String
  customerPhone String?
  waiverName    String
  waiverAgreed  Boolean
  paid          Boolean      @default(false)
  redeemed      Boolean      @default(false)
  redeemedAt    DateTime?
  createdAt     DateTime     @default(now())
  waiverId      Int?
  class         Class        @relation(fields: [classId], references: [id])
  package       ClassPackage @relation(fields: [packageId], references: [id])
  waiver        Waiver?      @relation(fields: [waiverId], references: [id])
}

model Waiver {
  id               Int              @id @default(autoincrement())
  firstName        String
  lastName         String
  email            String
  phone            String?
  dateOfBirth      DateTime?
  emergencyContact String
  emergencyPhone   String
  relationship     String?
  healthConditions String?
  injuries         String?
  medications      String?
  isPregnant       Boolean          @default(false)
  pregnancyWeeks   Int?
  digitalSignature String
  waiverAgreed     Boolean          @default(false)
  healthInfoAgreed Boolean          @default(false)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  bookings         Booking[]
  packageBookings  PackageBooking[]
}
